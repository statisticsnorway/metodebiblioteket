---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# metodebiblioteket

[![R-CMD-check](https://github.com/statisticsnorway/metodebiblioteket/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/statisticsnorway/metodebiblioteket/actions/workflows/R-CMD-check.yaml)
[![pytest](https://github.com/statisticsnorway/metodebiblioteket/actions/workflows/pytest-check.yaml/badge.svg)](https://github.com/statisticsnorway/metodebiblioteket/actions/workflows/pytest.yaml)


Denne repo-en inneholder informasjon om funksjoner som danne SSBs Metodebiblioteket. Du kan se på biblioteket her:

**<https://statisticsnorway.github.io/metodebiblioteket/>**


## Installasjon

Repoen er organiserte som en R-pakke. For å installere det og alle avhengige metode pakke

Du kan installere R-pakken metodebiblioteket fra [GitHub](https://github.com/statisticsnorway/metodebiblioteket/) ved:

``` r
renv::install("statisticsnorway/metodebiblioteket")
```

## Nøkkelord
Nøkkelørd som brukes i Metodebiblioteket er baserte på dokumentet [Metodikk for modernisering av
statistikkproduksjonen](https://www.ssb.no/teknologi-og-innovasjon/artikler-og-publikasjoner/_attachment/419848?_ts=171cb1a9850):

|Hovednøkkelord |Nøkkelord |
|:------|:---------|
|kontrollere|regelbasert <br> statistikk |
|imputere| modelbasert <br> donor |
|struktuere||
|indeksberegning||
|vektberegning|modelbasert <br> designbasert |
|usikkerhetsberegning||
|sesongjustering||
|analyse||
|konfidensialitet|undertrykking <br> avrunding <br> støylegging|


## Enhetstester
Hver funksjon i Metodebiblioteket skal ha minst en enhetstest knyttet til den. Dette er for å forsikre kvalitet og kunne tester funksjoner på nye og gamle R installasjoner. 

Følgende tabellen viser hvilke funksjoner mangler enhetstester eller har enhetstester som feiler


```{r, echo=FALSE}
library(magrittr)
library(kableExtra)

all_funcs <- read.csv("data/katalogdata.csv")$func
func_tab <- data.frame(funksjon_navn = all_funcs, status = "mangler", detaljer = "")
test_files <- list.files("tests/testthat/")
test_files <- test_files[test_files != "_snaps"]

for (t in test_files){
  con <- file(file.path("./tests/testthat", t))
  line <- readLines(con)
  
  for (i in 1:nrow(func_tab)){
    f <-  func_tab$funksjon_navn[i]
    func_patt <- paste0(f, "\\(")
    found <- grep(func_patt, line)
    if (length(found) != 0){
      for (l in line[found]){
        if (!grepl('^\\#', l)) {
          func_tab$status[i] <- "testet"
        }
      }
    }
  }
  close(con)
}
failed <- metodebiblioteket:::get_failing()
m <- match(failed$func, func_tab$funksjon_navn)
func_tab[m, "status"] <- "feil"
func_tab[m, "detaljer"] <- failed$test
func_tab <- func_tab[func_tab$status %in% c("mangler", "feil"),]
suppressWarnings(
func_tab$status <- cell_spec(func_tab$status, color = "white", background = ifelse(func_tab$status == "testet", "#48BF91", ifelse(func_tab$status == "mangler", "orange", "red")))
)
suppressWarnings(
kableExtra::kbl(func_tab, format = "pipe") %>%
  kableExtra::kable_paper("striped", full_width = F)
)
```

## Linker
Metodebiblioteket innholder mange linker til dokumentasjon av funksjoner. Følgende funksjoner har linker som feiler:

```{r, echo = FALSE}
bb <- metodebiblioteket:::get_bad_links()
row.names(bb) <- NULL
names(bb) <- c("funksjon_navn", "pakke")
kableExtra::kbl(bb, format = "pipe")

```

